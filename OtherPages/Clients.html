<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Global Natural Stones</title>
			
		<link rel="stylesheet" href="../Stylesheets/Reset.css" type="text/css" />
		<link rel="stylesheet" href="../Stylesheets/MainStyles.css" type="text/css"/>
		<link rel="stylesheet" href="../JQUI/jquery-ui.css"/>
    	
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>

		<!-- Icons -->
		<script src='https://kit.fontawesome.com/a076d05399.js'></script>
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		
		<script name="TestData" src="Scripts/TestDatabase.js"></script>	
		<script name="ConstVars">
			const CDATA_FADESPEED = 120;
		</script>
		
		<script type="text/javascript" src="../JQUI/external/jquery/jquery.js"></script>
		<script type="text/javascript" src="../JQUI/jquery-ui.js"></script>
		
		

	</head>

	<body>
		<script src="MainHeader.js"></script>
		<script>display("Clients");</script>
		
		<div class="big-container">
			<!--side navigation-->
			<aside>				
				<nav id="ClientCategories">			
					
					<div class="SmallCategories">
						<h2>View clients by...</h2>											
						<button class="SmallCatButtons neat-button">Stage 1</button>
						<button class="SmallCatButtons  neat-button">Stage 2</button>
						<button class="SmallCatButtons  neat-button">Archived</button>
						
					</div>
					
					

					<form>
						<button id="AddClient" class="GreenAdd">+ Add Client</button>
					</form>
				</nav>				
			</aside>
			
			<!--list of clients -->
			<main>
				<ul id="ClientList">
					<!--each li is a client-->
					<div class="sectionHeading">
						<h1 id="sectionTitle">Stage 1</h1>
						<p> Sort by: 
							<select id="SortBy">
								<option value="New" selected>Newest to Oldest</option>
								<option value="Old">Oldest to Newest</option>
								<option value="FirstName">First Name</option>
								<option value="LastName">Last Name</option>
							</select>
						</p>
					</div>
					<hr>
					
					<li class="Client">
						<section class="ListHead">
							<h4>Joe Johnson</h4>
							<p class="cliID">1</p>
							<p>Joined 22 January, 2020</p>
							<div class="CHeadTopLinks ">
								<div>
									<button class="btnShowInfo">Show All</button>
									<button class="btnEditInfo">Edit</a>
								</div>
							</div>
						</section>
						
						<section class="ClientInfo">
							<nav class="SmallCategories">
								<button class="SmallCatButtons Basic">Basic</button>
								<button class="SmallCatButtons Installation">Installation</button>
								<button class="SmallCatButtons Estimate">Estimate/Balance</button>
								<button class="SmallCatButtons Availability">Availability</button>
								<button class="SmallCatButtons Comments">Comments</button>
							</nav>
							
							<div class="ClientData">
								<span class="Info"><h5>Phone:</h5><p class="CPhone">(478) 999-9999</p></span>
								<span class="Info"><h5>Email:</h5><p class="CEmail">JimmyJohJohnson@email.com</p></span>
								
								<span class="Info"><h5>Address:</h5><p class="CAddress">123 Rainbow Road</p></span>
								<span class="Info"><h5>City:</h5><p class="CCity">Dayton</p></span>
								<span class="Info"><h5>State:</h5><p class="CState">OH</p></span>
								<span class="Info"><h5>Zip:</h5><p>12345</p></span>
								
								<span class="Info"><h5>Projects:</h5><p>Cabinet, Appliances, Floor</p></span>
							</div>
							
							<button class="ClientNextPhase">Move client to next phase</button>
							
						</section>
					</li>

					
				</ul>
			</main>
    </div>
	
		<script name="SortFunctions" src="Scripts/SortDisplayFunctions.js"></script>
     
		<script name="MakeNewWindow-ClientMoreInfo">
		
		const { ipcRenderer } = require('electron');
		
		//when the show info button clicked
		document.querySelector(".btnShowInfo").addEventListener("click", function() {
			//send the 'display-client' command to the main js (will display new page with client info)
			//needs id
			let cliID = $(this).parent().parent().parent().find(".cliID").text();
			
			ipcRenderer.send("display-client-Info", getClient(AllClients, cliID));
		});
		
		document.querySelector(".btnEditInfo").addEventListener("click", function() {
			//send the 'display-client-edit' command to the main js (will display new page with client info)
			//needs id
			let cliID = $(this).parent().parent().parent().find(".cliID").text();
			
			ipcRenderer.send("display-client-edit", getClient(AllClients, cliID));
		});

		//Update the profile picture
		window.onload = () => {
			ipcRenderer.send("user");
		}
		ipcRenderer.on("getUser", (event, user) => {
			document.getElementById('profilePic').setAttribute('src',user.picture);
		});
		</script>
		
		<script name="ExpandClientInfoClick">
		
		$(document).ready( function() {
			
			//displays the client information when clicking on an li
			$(".ListHead").click(function() {			
				var thisClient = $(this).parent();
				
				//closes all other clint info's				
				$('.Client').not(thisClient).find(".ClientInfo").hide(400);
				$('.Client').not(thisClient).find(".CHeadTopLinks").hide(400);
				
				//opens the clicked client info
				$(thisClient).find(".ClientInfo").animate({height: "toggle"});
				$(thisClient).find(".CHeadTopLinks").toggle(400);
			});
		
		});
		</script>
		
		<script name="DisplayClients">
			/* ANDREW NEEDS CODE IN PopulateMain FUNCTION */
			let currentStageForm = 1;
			
			//populate the basic client section
			function populateBasic(clientBas, thisCliInfo){
				let clientData = $(thisCliInfo).find(".ClientData");
			
				$("<label class='info'>Phone: <p>" + clientBas.Phone + "</p></label>").appendTo(clientData).fadeIn(CDATA_FADESPEED);
				
				$("<label class='info'>Email: <p>" + clientBas.Email + "</p></label>").appendTo(clientData).fadeIn(CDATA_FADESPEED);
				
				$("<label class='info'>Address: <p>" + clientBas.Address1.Street + "</p></label>").appendTo(clientData).fadeIn(CDATA_FADESPEED);
				
				$("<label class='info'>City: <p>" + clientBas.Address1.City + "</p></label>").appendTo(clientData).fadeIn(CDATA_FADESPEED);
				
				$("<label class='info'>State: <p>" + clientBas.Address1.State + "</p></label>").appendTo(clientData).fadeIn(CDATA_FADESPEED);
				
				$("<label class='info'>Zip code: <p>" + clientBas.Address1.Zip + "</p></label>").appendTo(clientData).fadeIn(CDATA_FADESPEED);
				
				let projects = allinone(clientBas.Projects);
				$("<label class='info'>Projects: <p>" + projects + "</p></label>").appendTo(clientData).fadeIn(CDATA_FADESPEED);
			}
			
			//populate basic form
			function populateMain(currentStage){
				console.log("Loading clients from stage " + currentStage);
				var Client;
				
				//remove clients in the form already
				/* ADD FOLLOWING ONCE ANDREW'S CODE IS IMPLEMENTED */
				/*$("main").children().fadeOut(
					120, 
					function() {$(this).remove();}
				
				);*/
			
				for (Client of AllClients){
					if (Client.Stage == currentStage){
					/* SHOULD BE REPLACED WITH ANDREW'S CODE */
						console.log(Client.Fname + " is printed.");
					}
				}
			}			
			populateMain(1);
			
			
			//jquery, give all butons stage attr and handle clicking
			$(document).ready(function(){

				//fill buttons with stage info
				let btnNum = 1;
				$(".SmallCatButtons").each(function(){
					$(this).attr("Stage", btnNum++);
				});
				
				
				//when the button is clicked, fill the main
				$("aside .SmallCatButtons").click(function(){
					$("#sectionTitle").text($(this).text());
					currentStageForm = $(this).attr("stage");
					
					//populate main with the stage value of the button
					populateMain(currentStageForm);
							
				});
				
				//jQUI sort by combo box
				$("#SortBy").selectmenu({
					width: 200,
					  classes: {
						"ui-selectmenu-button": "custom-clear",
						"ui-selectmenu-text": "custom-underline",
						"ui-selectmenu-button-closed": "custom-clear"
					  },
				
					change: function(event, data){
						switch (data.item.value){
							case "New":
								sortByNewest(AllClients);
								break;
							case "Old":
								sortByOldest(AllClients);
								break;
							case "FirstName":
								sortByFirstName(AllClients);
								break;
							case "LastName":
								sortByLastName(AllClients);
								break;
						}
						
						populateMain(currentStageForm);
					}
				});	
				
			});
			
			

		</script>
		
		
		<script name="NavigateClients">
			$(document).ready(function(){
			
				$(".ClientInfo .SmallCategories button").click(function(){
					let ThisClientInfo = $(this).parent().parent();
					
					//remove the things already there
					$(ThisClientInfo).find(".ClientData").children().fadeOut(
						CDATA_FADESPEED, 
						function() {$(this).remove();}
					);
					
					//fill info 
					let ThisClientData = $(ThisClientInfo).find(".ClientData");
					
					if ($(this).hasClass("Installation")){
						//display Template
						console.log("client template is displayed");
						
						$("<p>Template stuff</p>").hide().appendTo(ThisClientData).fadeIn(CDATA_FADESPEED);
					}
					else if ($(this).hasClass("Estimate")){
						//display Invoice
						console.log("client invoice is displayed");
						
						$("<p>Invoice stuff</p>").hide().appendTo(ThisClientData).fadeIn(CDATA_FADESPEED);
					}
					else if ($(this).hasClass("Availability")){
						//display install stuff
						console.log("client install is displayed");
						
						$("<p>Installation stuff</p>").hide().appendTo(ThisClientData).fadeIn(CDATA_FADESPEED);
					}
					else if ($(this).hasClass("Comments")){
						//display install stuff
						console.log("client comments are displayed");
						
						$("<p>Comments</p>").hide().appendTo(ThisClientData).fadeIn(CDATA_FADESPEED);
					}
					else {
						//display basic (if none other found)
						populateBasic(AllClients[ThisClientInfo.parent().find(".cliID").text()].Basic, ThisClientInfo);
					}
				});
				
			});
		</script>
	</body>
</html>