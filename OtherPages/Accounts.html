<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Global Natural Stones</title>
		
		<!-- Our Styles -->
		<link rel="stylesheet" href="../Stylesheets/Reset.css" type="text/css">
		<link rel="stylesheet" href="../Stylesheets/MainStyles.css" type="text/css"/>
		<link rel="stylesheet" href="../JQUI/jquery-ui.css"/>

		<!-- Icons -->
		<script src='https://kit.fontawesome.com/a076d05399.js'></script>
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		
		<!-- jQuery -->
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
		
		<!-- jQuery UI -->
		<script type="text/javascript" src="../JQUI/external/jquery/jquery.js"></script>
		<script type="text/javascript" src="../JQUI/jquery-ui.js"></script>
	</head>
	  
	<body>
		<script src="MainHeader.js"></script>
		<script>
			display("Accounts");
			const {ipcRenderer} = require("electron");
			//Update the profile picture
			window.onload = () => {
				ipcRenderer.send("user");
				ipcRenderer.send("users");
			}
			ipcRenderer.on("getUser", (event, user) => {
				document.getElementById('profilePic').setAttribute('src',user.picture);
			});
			ipcRenderer.on("users", (event, users) => {
				console.log(users);
				let list = $("#accMain > ul");
				for (let user of users) {
					const item = `
					<li>
						<section class="ListHead">
							<h4>${user.email}</h4>
							${(user.online) ? "Online" : "Offline"}
						</section>
					</li>
					`;
					list.append(item);
				}

			});
		</script>
		
		<div id="newAcctForm">
			<form>
				<h2>Create a new user</h2><br>
				<label for="email">Google account</label>
				<input type="email" name="email" id="email" />
			</form>
		</div>
		
		<!-- holds the navs right under the header -->
		<article>
			<nav class="AddRemove">
				<button class="GreenAdd">+ Add</button>
				<button class="RedRemove">- Remove</button>
			</nav>	
		</article>
		
		<!-- the list of employees registered on the site-->
		<main id="accMain">
			<ul>
				
			</ul>
		</main>
		
		<script>
		let newEmail = "";
		
		$(document).ready(function(){
			$("#SortBy").selectmenu({
				width: 200,
				  classes: {
					"ui-selectmenu-button": "custom-clear",
					"ui-selectmenu-text": "custom-underline",
					"ui-selectmenu-button-closed": "custom-clear"
				  },
			
				change: function(event, data){
					
				}
			});
			
			$("#newAcctForm").dialog({
				autoOpen: false,
				modal: true,
				height: 270,
				width: 350,
				
				buttons:[
					{
						text: "Create user",
						click: function(){
							var email = $("#email").val();
							var emailRegex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
							
							if (email === '' || !(email).match(emailRegex)) {
								alert("Invalid Email");
							} else {
								newEmail = email;
								$("#newAcctForm").dialog("close");
							}
						}
					},
					{
						text: "Cancel",
						click: function(){
							$("#newAcctForm").dialog("close");
						}
					}
				],
				
				close: function(){
					if (newEmail != ""){
						jsonMsg = { email: newEmail };					
						ipcRenderer.send("addUser", jsonMsg); //[DEV]
						
						newEmail = "";
					}
				}
			});
			
			$(".GreenAdd").click(function(){
				$("#newAcctForm").dialog("open");
			})
		});
		</script>
	</body>
</html>